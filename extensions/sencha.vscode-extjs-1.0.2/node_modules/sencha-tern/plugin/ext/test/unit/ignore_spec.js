'use strict';

var should = require('./../lib/chai_setup'),
    ignore = require('../../lib/ignore'),
    TestUtil = require('./../lib/test_util'),
    path = require('path'),
    fs = require('fs-extra');

describe('ignore', function() {
    describe('ensureIgnored', function() {
        it('should create a gitignore file if none exists', function() {
            try {
                TestUtil.reset(path.join('ignore', 'ensureIgnored', 'empty'));
                var gitignore = path.join(process.cwd(), '.gitignore');
                ignore.ensureIgnoredSync(process.cwd(), "temp", 'comment');
                fs.readFileSync(gitignore, 'utf8').should.eq('# comment\ntemp');
            } finally {
                var gitignore = path.join(process.cwd(), '.gitignore');
                if (fs.existsSync(gitignore)) fs.removeSync(gitignore);
            }
        });

        it('should append to the existing .gitignore file', function() {
            TestUtil.reset(path.join('ignore', 'ensureIgnored', 'exists'));
            var gitignore = path.join(process.cwd(), '.gitignore');
            ignore.ensureIgnoredSync(process.cwd(), "temp", 'comment');
            fs.readFileSync(gitignore, 'utf8').should.eq('foo\n\n# comment\ntemp');
        });
    });
});
