"use strict";

var testSdk = require('./test_sdk');

describe('sdks', function() {
    this.timeout(60000); // the first request takes some time as the Ext JS SDK is parsed - need to lengthen the timeout to prevent failure

    describe('Ext JS 5.1.2', function() {
        testSdk('extjs5.1.2', 'ext/docs-output', 'app/test.js', [
            // docs are wrong, this should be a member of Ext
            'Ext.ClassManager is missing class members: getDisplayName',

            // This class isn't even declared
            'Ext.dd.DragDropElement is missing instance members: getPosX, getPosY, getScrollLeft, getScrollTop, getStyle, handleWasClicked, moveToEl, numericSort, swapNode',

            // the comment-parser library can't read tags here - we'll live with it for now.
            'Ext.dom.CompositeElement is missing instance members: findParentNode',
            'Ext.dom.CompositeElementLite is missing instance members: findParentNode',
            'Ext.dom.Element is missing instance members: findParentNode',
            'Ext.dom.Fly is missing instance members: findParentNode',
            'Ext.fx.Animator is missing configs: keyframes',

            // no @class tag - would need to support Ext.extend
            'Ext.ux.DataViewTransition is missing instance members: cachedStoreData, dataview, dataviewID, defaults, cacheStoreData, getAdded, getExisting, getExistingCount, getRemaining, getRemoved, init',

            // no @class tag - would need to support // @define
            'Ext.Assert is missing instance members: falsey, falseyProp, truthy, truthyProp'
        ]);
    });

    describe('Ext JS 6.0.1', function() {
        var ignoreErrors = [
            // docs are wrong, this should be a member of Ext
            'Ext.ClassManager is missing class members: getDisplayName',

            // This class isn't even declared
            'Ext.dd.DragDropElement is missing instance members: getPosX, getPosY, getScrollLeft, getScrollTop, getStyle, handleWasClicked, moveToEl, numericSort, swapNode',

            // the comment-parser library can't read tags here - we'll live with it for now.
            'Ext.fx.Animator is missing configs: keyframes',
            'Ext.direct.AmfRemotingProvider is missing configs: actions',

            // Comma after comment messes this one up - should fix in Ext JS source
            'Ext.draw.sprite.Sprite is missing class members: debug',
            'Ext.draw.sprite.Text is missing instance members: debug',
            'Ext.chart.label.Label is missing instance members: debug',

            // JSDuck finds a member with just a blank space for a name
            'Ext.scroll.Scroller is missing instance members: ',

            // Should fix this in Ext JS source - need space between tag and type
            'Ext.Toast is missing configs: animation',

            // Bug: JSDuck thinks all members after @override are members of the overridden class.
            'Ext.chart.Legend is missing instance members: actionRow, autoSizeColumn, focusCell, walkRecs',
            'Ext.chart.LegendBase is missing instance members: actionRow, autoSizeColumn, focusCell, walkRecs',
            'Ext.picker.Time is missing instance members: actionRow, autoSizeColumn, focusCell, walkRecs',
            'Ext.view.BoundList is missing instance members: actionRow, autoSizeColumn, focusCell, walkRecs',
            'Ext.view.View is missing instance members: actionRow, autoSizeColumn, focusCell, walkRecs'
        ];

        testSdk('extjs6.0.1', 'docs-output/classic', 'classic/src/test.js', ignoreErrors);
        testSdk('extjs6.0.1', 'docs-output/modern', 'modern/src/test.js', ignoreErrors);
    });
});