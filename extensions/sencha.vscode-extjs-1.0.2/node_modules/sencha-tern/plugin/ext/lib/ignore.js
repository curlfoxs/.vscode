var path = require('path'),
    fs = require('fs');

module.exports = {
    /**
     * Ensures that the specified path is added to the .gitignore file in the specified directory
     * @param {String} dir The directory to write .gitignore to
     * @param {String} pathToIgnore The path to ignore
     * @param {String} comment
     */
    ensureIgnoredSync: function(dir, pathToIgnore, comment) {
        var gitignore = path.join(dir, '.gitignore'),
            contents = [];

        if (fs.existsSync(gitignore)) {
            contents = fs.readFileSync(gitignore, 'utf8').split(/\r?\n/);
        }

        if (contents.indexOf(pathToIgnore) === -1) {
            if (comment)  {
                if (contents.length && contents[contents.length-1] !== '') contents.push(''); // add blank line so the comment looks pretty
                contents.push("# " + comment);
            }
            contents.push(pathToIgnore);
            fs.writeFileSync(gitignore, contents.join("\n"), 'utf8');
        }
    }
};