# Tern

A REST server that provides code completion for Ext JS based on https://github.com/marijnh/tern.

It is currently based off of tern 0.13.1

## Build Status

* Main
 * Mac OS: [![Build Status](https://teamcity.sencha.com/app/rest/builds/buildType:Tern_MainMacos/statusIcon)](https://teamcity.sencha.com/viewType.html?buildTypeId=Tern_MainMacos)
 * Windows: [![Build Status](https://teamcity.sencha.com/app/rest/builds/buildType:Tern_MainWindows/statusIcon)](https://teamcity.sencha.com/viewType.html?buildTypeId=Tern_MainWindows)

### API

In addition to the methods documented [here](http://ternjs.net/doc/manual.html#protocol), this fork of tern implements the following additional methods:

* GET /refresh - reindexes all new/modified files and purges deleted ones.  Call this when bulk changes are made, such as moving or deleting a folder.
* GET /namespace?dir=/Project/app/view/user - returns { namespace: 'App.view.user' }
* GET /stop - shuts down tern after writing indexes
* GET /classes?name=MyApp.view.MyView - returns an array of file paths that define a class matching the specified name. Matching is partial and case-insensitive.

## Project Configuration

Tern automatically discovers all apps and sdks in the project directory (specified with --dir).  You can make tern index 
additional paths by editing the .sencha/ide/config.json file that tern creates the first time it is started.

This file is JSON syntax containing the following properties:

 * include - An array of directories outside of project directory which should be indexed.
 * exclude - An array of directories to exclude from indexing.
 * apps - An array describing the location of each app in the project.  Apps only need to be listed here if they were not built using Sencha Cmd.  Any apps built with Cmd will be automatically detected.

### Example .sencha/ide/config.json

    {
        "include": [
            "path/to/dir/to/include"
        ],
        "exclude": [
            "path/to/dir/to/exclude"
        ],
        "apps" : [
            {
                "name": "AppRootNamespace",
                "path": "path/to/app",
                "toolkit": "classic|modern",
                "sdk": {
                    "path": "path/to/sdk",
                    "version": "sdk version - e.g. 6.0.1",
                    "framework": "extjs|touch"
                }
            }
        ]
    }

### Error Codes

78 - .sencha-ide-config could not be parsed due to invalid JSON.

## Development Environment

#### Install project dependencies

    npm install

#### Install gulp and mocha

    npm install -g gulp mocha

## Unit Tests
    
Unit tests are located in plugin/ext/test/unit.  To run these from WebStorm, create a new Mocha run configuration with 
plugin/ext/test/unit as the test directory.

These can be run via teamcity using "npm test".

## Integration Tests

This project contains integration tests that verify code completion against all configs, properties, methods, and events 
for Ext JS 4-6 and Sencha Touch 2.  These are located in plugin/ext/test/integration. To run these from WebStorm, 
create a new Mocha run configuration with plugin/ext/test/integration as the test directory.

These can be run via teamcity using "npm test-sdks".

## Use with Atom

You can use Atom as a simple tern client.  Atom has the advantage of allowing you to see all the of communication
with tern via the chrome debugger (option-cmd-i on mac)

Mark Brocato maintains a fork of the atom-ternjs atom plugin that makes it easy to use Sencha's fork of tern with atom.  
To install the atom plugin, fork the following repo and follow the instructions in the readme:

https://github.com/markbrocato/atom-ternjs

Once installed, create a run configuration in WebStorm for Node.js with:
    
    JavaScript file: bin/tern
    Working Directory: /path/to/project
    Application parameters: --port 12345 --persistent
    
## Building for Eclipse and Visual Studio plugin development

The deploy-dev gulp task builds tern using jxcore and copies the executable and tern.version file to the location specified by the TERN_BUILD_DIR environment variable

    export TERN_BUILD_DIR=/Users/mbrocato/Code/EclipsePlugin/com.sencha.eclipse/tern
    gulp deploy-dev

## Creating an Example Ext JS App Project

You can use sencha cmd to create a basic project to get started:

1. Clone the SDK repo
    
        git clone git@github.com:extjs/SDK.git
 
2. Download and install Sencha Cmd: https://www.sencha.com/products/extjs/cmd-download/

3. Run:

        sencha --sdk /path/to/sdk generate app Test Test
        
4. From the root run the following to start tern

        node bin/tern.js --dir /path/to/ext/app --port <port>

## Running Production Bundles

### Windows

    tern --dir \path\to\ext\app --port <port> --license c:\path\to\license

### Mac OSX

    ./tern --dir /path/to/ext/app --port <port> --license /path/to/license

* --license is required.  Tern will exit immediately with a failure code if a valid license is not present. 
* --port is optional.  Tern will automatically pick an open port and write it to .tern-port in the directory specified by --dir
* --app is optional.  The value should be the name of the app using tern (for example "eclipse").  This is used in reporting to rollbar.
* --jasmine is optional.  If true, code completion for jasmine will be included.

    
